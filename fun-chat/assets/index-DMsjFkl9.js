var R=Object.defineProperty;var W=(n,t,e)=>t in n?R(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var i=(n,t,e)=>(W(n,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const l of r.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();function w(n){return n!=null}function V(n,t){return t instanceof n}function y(n){return typeof n=="string"}function L(){return Math.floor(Math.random()*1e4)+1}function $(n){const t=JSON.stringify(n);sessionStorage.setItem("user",t)}function F(){const n=sessionStorage.getItem("user");return n?JSON.parse(n):null}function z(n){const t=sessionStorage.getItem("user");if(t){const e=JSON.parse(t);e.isLogined=n,$(e)}}function B(){const n=sessionStorage.getItem("user")||"";return JSON.parse(n).id||""}function v(){const n=sessionStorage.getItem("user")||"";return n&&JSON.parse(n).isLogined||!1}function G(){const n=sessionStorage.getItem("user");let t;return n&&(t=JSON.parse(n).login),t||""}function J(n){const t=new Date(n),e=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear(),r=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0"),g=String(t.getSeconds()).padStart(2,"0");return`${e}.${s}.${a}, ${r}:${l}:${g}`}const N=new WeakMap;class o{constructor(t,e){i(this,"nodeElement");i(this,"resizeObserver");const{className:s="",text:a="",id:r=void 0,children:l=[]}=e??{};if(!y(t)&&w(t)&&o.findComponentOf(t))throw new Error(`Component of ${String(t)} already exists`);const g=y(t)?document.createElement(t):t;r&&(g.id=r),l&&this.appendChildren(l),g.className=s,g.textContent=a,this.nodeElement=g,N.set(this.nodeElement,this)}static setStyles(t,e){Object.assign(t.style,{...e})}static findComponentOf(t){const e=N.get(t);if(w(e))return e}appendChild(t){return this.nodeElement.appendChild(t.nodeElement),t}appendChildren(t){return t.forEach(e=>{this.appendChild(e)}),this}get element(){return this.nodeElement}getChildAt(t){return this.getChildren()[t]}getChildren(t){const e=Array.from(this.nodeElement.childNodes).map(s=>o.findComponentOf(s)).filter(s=>w(s));return w(t)?e.filter(s=>V(t,s)):e}get childrenCount(){return this.nodeElement.childNodes.length}setTextContent(t){return this.nodeElement.textContent=t,this}setAttribute(t,e){return this.nodeElement.setAttribute(t,e),this}removeAttribute(t){this.nodeElement.removeAttribute(t)}toggleClass(t,e){return t&&this.nodeElement.classList.toggle(t,e),this}observe(t){return this.unobserve(),this.resizeObserver=new ResizeObserver(e=>t(e[0])),this.resizeObserver.observe(this.nodeElement),this}unobserve(){return w(this.resizeObserver)&&(this.resizeObserver.disconnect(),this.resizeObserver=null),this}destroy(){this.unobserve(),this.destroyChildren(),this.nodeElement.remove()}destroyChildren(){this.getChildren().forEach(t=>{t.destroy()})}}const Z="_footer_wwasf_3",K="_footer-container_wwasf_27",X="_social-items_wwasf_45",j="_social-item_wwasf_45",Y="_developer_wwasf_81",Q="_social-item-link_wwasf_81",ee="_rs-icon-wrap_wwasf_115",te="_rsschool-link_wwasf_131",d={footer:Z,"footer-container":"_footer-container_wwasf_27",footerContainer:K,"social-items":"_social-items_wwasf_45",socialItems:X,"social-item":"_social-item_wwasf_45",socialItem:j,developer:Y,"social-item-link":"_social-item-link_wwasf_81",socialItemLink:Q,"rs-icon-wrap":"_rs-icon-wrap_wwasf_115",rsIconWrap:ee,"rsschool-link":"_rsschool-link_wwasf_131",rsschoolLink:te};class se extends o{constructor(){super("footer",{className:`${d.footer}`}),this.render()}render(){this.element.innerHTML=`
    <div class="${d.footerContainer}">
      <ul class="${d.socialItems} ${d.developer}">
        <li class="${d.socialItem}">
          <a class="${d.socialItemLink}" href="https://github.com/Tetiana-KET" target="_blank">
            Tetiana
          </a>
        </li>
        <li class="${d.socialItem}">
          <a class="${d.socialItemLink}" href="https://github.com/Tetiana-KET" target="_blank">
            <svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="#ffffff" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0138.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg>
          </a>
        </li>
      </ul>
      <div class="${d.rsIconWrap} ${d.rsIconWrap}">
        <a href="https://rs.school/" class="${d.socialItem} ${d.rsschoolLink}" target="_blank">
        </a>
      </div>
      <ul class="${d.socialItems} ${d.rsSchool}">
        <li class="${d.socialItem} ${d.socialYear}">
          2024
        </li>
        <li class="${d.socialItem}">
          <a class="${d.socialItemLink}" href="https://www.youtube.com/c/rollingscopesschool" target="_blank">
            <svg viewBox="64 64 896 896" focusable="false" data-icon="youtube" width="1em" height="1em" fill="#ffffff" aria-hidden="true"><path d="M941.3 296.1a112.3 112.3 0 00-79.2-79.3C792.2 198 512 198 512 198s-280.2 0-350.1 18.7A112.12 112.12 0 0082.7 296C64 366 64 512 64 512s0 146 18.7 215.9c10.3 38.6 40.7 69 79.2 79.3C231.8 826 512 826 512 826s280.2 0 350.1-18.8c38.6-10.3 68.9-40.7 79.2-79.3C960 658 960 512 960 512s0-146-18.7-215.9zM423 646V378l232 133-232 135z"></path></svg>
          </a>
        </li>
        <li class="${d.socialItem}">
          <a class="${d.socialItemLink}" href="https://discord.com/invite/PRADsJB" target="_blank">
            <svg width="1em" height="1em" fill="#ffffff" viewBox="0 -7 71 71" xmlns="http://www.w3.org/2000/svg"><g><path d="M60.1045 4.8978C55.5792 2.8214 50.7265 1.2916 45.6527 0.41542C45.5603 0.39851 45.468 0.440769 45.4204 0.525289C44.7963 1.6353 44.105 3.0834 43.6209 4.2216C38.1637 3.4046 32.7345 3.4046 27.3892 4.2216C26.905 3.0581 26.1886 1.6353 25.5617 0.525289C25.5141 0.443589 25.4218 0.40133 25.3294 0.41542C20.2584 1.2888 15.4057 2.8186 10.8776 4.8978C10.8384 4.9147 10.8048 4.9429 10.7825 4.9795C1.57795 18.7309 -0.943561 32.1443 0.293408 45.3914C0.299005 45.4562 0.335386 45.5182 0.385761 45.5576C6.45866 50.0174 12.3413 52.7249 18.1147 54.5195C18.2071 54.5477 18.305 54.5139 18.3638 54.4378C19.7295 52.5728 20.9469 50.6063 21.9907 48.5383C22.0523 48.4172 21.9935 48.2735 21.8676 48.2256C19.9366 47.4931 18.0979 46.6 16.3292 45.5858C16.1893 45.5041 16.1781 45.304 16.3068 45.2082C16.679 44.9293 17.0513 44.6391 17.4067 44.3461C17.471 44.2926 17.5606 44.2813 17.6362 44.3151C29.2558 49.6202 41.8354 49.6202 53.3179 44.3151C53.3935 44.2785 53.4831 44.2898 53.5502 44.3433C53.9057 44.6363 54.2779 44.9293 54.6529 45.2082C54.7816 45.304 54.7732 45.5041 54.6333 45.5858C52.8646 46.6197 51.0259 47.4931 49.0921 48.2228C48.9662 48.2707 48.9102 48.4172 48.9718 48.5383C50.038 50.6034 51.2554 52.5699 52.5959 54.435C52.6519 54.5139 52.7526 54.5477 52.845 54.5195C58.6464 52.7249 64.529 50.0174 70.6019 45.5576C70.6551 45.5182 70.6887 45.459 70.6943 45.3942C72.1747 30.0791 68.2147 16.7757 60.1968 4.9823C60.1772 4.9429 60.1437 4.9147 60.1045 4.8978ZM23.7259 37.3253C20.2276 37.3253 17.3451 34.1136 17.3451 30.1693C17.3451 26.225 20.1717 23.0133 23.7259 23.0133C27.308 23.0133 30.1626 26.2532 30.1066 30.1693C30.1066 34.1136 27.28 37.3253 23.7259 37.3253ZM47.3178 37.3253C43.8196 37.3253 40.9371 34.1136 40.9371 30.1693C40.9371 26.225 43.7636 23.0133 47.3178 23.0133C50.9 23.0133 53.7545 26.2532 53.6986 30.1693C53.6986 34.1136 50.9 37.3253 47.3178 37.3253Z"></path></g></svg>
          </a>
        </li>
      </ul>
    </div>`}}class p{constructor(){i(this,"listeners",{})}subscribe(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)}emit(t,e){const s=this.listeners[t];s&&s.forEach(a=>a(e))}}const h=new p,f=new p,S=new p,M=new p,O=new p,H=new p,D=new p,q=new p,ie="_header-logo_11dqo_1",ae="_header_11dqo_1",oe="_header-container_11dqo_16",ne="_buttons-wrap_11dqo_25",re="_button_11dqo_25",le="_user-info_11dqo_49",de="_fadeInDown_11dqo_1",_={"header-logo":"_header-logo_11dqo_1",headerLogo:ie,header:ae,"header-container":"_header-container_11dqo_16",headerContainer:oe,"buttons-wrap":"_buttons-wrap_11dqo_25",buttonsWrap:ne,button:re,"user-info":"_user-info_11dqo_49",userInfo:le,fadeInDown:de};class ce extends o{constructor(e){super("header",{className:`${_.header}`,id:"header"});i(this,"headerContainer");i(this,"headerLogo");i(this,"buttonsWrap");i(this,"infoButton");i(this,"logOutButton");i(this,"userInfo");i(this,"userName",null);i(this,"webSocketAPI");this.webSocketAPI=e,this.headerContainer=new o("div",{className:`${_.headerContainer}`,id:"headerContainer"}),this.appendChild(this.headerContainer),this.headerLogo=new o("h2",{className:`${_.headerLogo}`,text:"Fun Chat"}),this.userInfo=new o("div",{className:`${_.userInfo}`,id:"userInfo"}),this.buttonsWrap=new o("div",{className:`${_.buttonsWrap}`}),this.infoButton=new o("button",{className:`${_.button}`,text:"About",id:"infoButton"}).setAttribute("type","button"),this.logOutButton=new o("button",{className:`${_.button}`,text:"Log out",id:"logOutButton"}).setAttribute("type","button").setAttribute("disabled",""),this.buttonsWrap.appendChildren([this.infoButton,this.logOutButton]),this.headerContainer.appendChildren([this.headerLogo,this.userInfo,this.buttonsWrap]),this.infoButton.element.addEventListener("click",this.onAboutBtnClick.bind(this)),this.logOutButton.element.addEventListener("click",this.onLogoutBtnClick.bind(this)),h.subscribe("aboutBtnClicked",this.disableAboutBtn.bind(this)),h.subscribe("successLogin",this.handleSuccessLogin.bind(this)),h.subscribe("backButtonClicked",this.enableAboutBtn.bind(this)),this.checkIsUserLogged()}setUserNameInHeader(){const e=sessionStorage.getItem("user");if(e){const s=JSON.parse(e);this.userName=s.login,this.userInfo.element.textContent=`${this.userName}`}}checkIsUserLogged(){v()?this.enableLogoutBtn():this.disableLogoutBtn()}onAboutBtnClick(e){window.location.hash="#about",h.emit("aboutBtnClicked",e)}onLogoutBtnClick(){this.userInfo.element.textContent="",this.disableLogoutBtn();let e,s;const a=sessionStorage.getItem("user");if(a){const r=JSON.parse(a);e=r.login,s=r.password}e&&s&&this.webSocketAPI.userLogout(e,s)}disableAboutBtn(){this.infoButton.element.setAttribute("disabled","")}enableAboutBtn(){this.infoButton.element.removeAttribute("disabled")}enableLogoutBtn(){this.logOutButton.element.removeAttribute("disabled")}disableLogoutBtn(){this.logOutButton.element.setAttribute("disabled","")}handleSuccessLogin(){this.setUserNameInHeader(),this.enableLogoutBtn()}}const ue="_about-page_l5qig_1",he="_about-page_wrapper_l5qig_7",ge="_about-page_title_l5qig_19",me="_about-page_description_l5qig_21",pe="_about-page_button_l5qig_24",_e="_about-page_developer_l5qig_34",b={"about-page":"_about-page_l5qig_1",aboutPage:ue,"about-page_wrapper":"_about-page_wrapper_l5qig_7",aboutPageWrapper:he,"about-page_title":"_about-page_title_l5qig_19",aboutPageTitle:ge,"about-page_description":"_about-page_description_l5qig_21",aboutPageDescription:me,"about-page_button":"_about-page_button_l5qig_24",aboutPageButton:pe,"about-page_developer":"_about-page_developer_l5qig_34",aboutPageDeveloper:_e};class E extends o{constructor(){super("section",{className:`${b.aboutPage}`,id:"aboutPage"});i(this,"aboutPageWrapper");i(this,"aboutPageTitle");i(this,"aboutPageDescription");i(this,"aboutPageBackButton");i(this,"aboutPageDeveloper");this.aboutPageWrapper=new o("div",{className:`${b.aboutPageWrapper}`,id:"aboutPageWrapper"}),this.aboutPageTitle=new o("h2",{className:`${b.aboutPageTitle}`,text:"Welcome to Fun Chat"}),this.aboutPageDescription=new o("p",{className:`${b.aboutPageDescription}`}),this.aboutPageBackButton=new o("button",{className:`${b.aboutPageButton}`,text:"Back",id:"aboutPageButton"}).setAttribute("type","button"),this.aboutPageDeveloper=new o("a",{className:`${b.aboutPageDeveloper}`,id:"loginForm"}),this.setAboutPageDescription(),this.setPageElements(),this.setDeveloperProperties(),this.appendChild(this.aboutPageWrapper),this.aboutPageBackButton.element.addEventListener("click",this.onBackButtonClick.bind(this))}setAboutPageDescription(){this.aboutPageDescription.element.textContent=`An interactive chat application developed as part of the RSSchool JS/FE 2023Q4 course. 
      Fun Chat provides users with a platform to engage in real-time communication through text messages.
      Key Features:
      Real-time Messaging: Engage in real-time conversations with other users.
      User Authentication: Securely log in to access the chat platform.
      Responsive Design: Enjoy a seamless experience across various devices and screen sizes.

      Experience the joy of real-time communication and connect with friends and colleagues in Fun Chat. Start chatting now and discover a new way to stay connected!`}setPageElements(){this.aboutPageWrapper.appendChildren([this.aboutPageTitle,this.aboutPageDescription,this.aboutPageDeveloper,this.aboutPageBackButton])}setDeveloperProperties(){this.aboutPageDeveloper.setAttribute("href","https://github.com/Tetiana-KET").setAttribute("target","_blank").setTextContent("Tetiana-KET")}onBackButtonClick(e){window.history.go(-1),h.emit("backButtonClicked",e)}}const be="_user-line_2kb04_1",we="_user-line_name_2kb04_8",fe="_user-line_status_2kb04_13",I={"user-line":"_user-line_2kb04_1",userLine:be,"user-line_name":"_user-line_name_2kb04_8",userLineName:we,"user-line_status":"_user-line_status_2kb04_13",userLineStatus:fe};class k extends o{constructor(e,s){super("li",{className:`${I.userLine}`});i(this,"userLineName");i(this,"userLineStatus");this.setAttribute("id",`${e}`),this.userLineName=new o("span",{className:`${I.userLineName}`,id:`userLineName_${e}`}).setTextContent(`${e}`),this.userLineStatus=new o("span",{className:`${I.userLineStatus}`,id:`userLineStatus_${e}`}).setAttribute("data-status",`${s}`),this.appendChildren([this.userLineStatus,this.userLineName])}}const Se="_chat-page_l3cpn_1",Ce="_chat-page_aside_l3cpn_9",Le="_chat-page_dialog_l3cpn_20",Ie="_aside_contact-search_l3cpn_31",ve="_dialog-input_l3cpn_32",Pe="_aside_users-list_l3cpn_44",Ue="_aside_user-line_l3cpn_54",Ae="_dialog-header_l3cpn_58",ye="_dialog-header_user-name_l3cpn_68",Be="_dialog-header_user-status_l3cpn_74",Ne="_dialog-body_l3cpn_78",Ee="_dialog-body_text_l3cpn_89",ke="_dialog-form_l3cpn_99",Te="_dialog-form-button_l3cpn_113",u={"chat-page":"_chat-page_l3cpn_1",chatPage:Se,"chat-page_aside":"_chat-page_aside_l3cpn_9",chatPageAside:Ce,"chat-page_dialog":"_chat-page_dialog_l3cpn_20",chatPageDialog:Le,"aside_contact-search":"_aside_contact-search_l3cpn_31",asideContactSearch:Ie,"dialog-input":"_dialog-input_l3cpn_32",dialogInput:ve,"aside_users-list":"_aside_users-list_l3cpn_44",asideUsersList:Pe,"aside_user-line":"_aside_user-line_l3cpn_54",asideUserLine:Ue,"dialog-header":"_dialog-header_l3cpn_58",dialogHeader:Ae,"dialog-header_user-name":"_dialog-header_user-name_l3cpn_68",dialogHeaderUserName:ye,"dialog-header_user-status":"_dialog-header_user-status_l3cpn_74",dialogHeaderUserStatus:Be,"dialog-body":"_dialog-body_l3cpn_78",dialogBody:Ne,"dialog-body_text":"_dialog-body_text_l3cpn_89",dialogBodyText:Ee,"dialog-form":"_dialog-form_l3cpn_99",dialogForm:ke,"dialog-form-button":"_dialog-form-button_l3cpn_113",dialogFormButton:Te};class T extends o{constructor(){super("section",{className:`${u.chatPage}`,id:"chatPage"});i(this,"aside");i(this,"contactSearch");i(this,"usersList");i(this,"dialogContainer");i(this,"dialogHeader");i(this,"dialogHeaderUserName");i(this,"dialogHeaderUserStatus");i(this,"dialogBody");i(this,"dialogBodyText");i(this,"dialogForm");i(this,"dialogInput");i(this,"dialogFormButton");this.aside=new o("aside",{className:`${u.chatPageAside}`,id:"chatPageAside"}),this.contactSearch=new o("input",{className:`${u.asideContactSearch}`,id:"asideContactSearch"}),this.usersList=new o("ul",{className:`${u.asideUsersList}`,id:"asideUsersList"}),this.dialogContainer=new o("article",{className:`${u.chatPageDialog}`,id:"chatPageDialog"}),this.dialogHeader=new o("h3",{className:`${u.dialogHeader}`,id:"dialogHeader"}),this.dialogHeaderUserName=new o("span",{className:`${u.dialogHeaderUserName}`,id:"dialogUserName"}),this.dialogHeaderUserStatus=new o("span",{className:`${u.dialogHeaderUserStatus}`,id:"dialogUserStatus"}),this.dialogBody=new o("div",{className:`${u.dialogBody}`,id:"dialogBody"}),this.dialogBodyText=new o("span",{className:`${u.dialogBodyText}`,id:"dialogBodyText"}),this.dialogForm=new o("form",{className:`${u.dialogForm}`,id:"dialogForm"}),this.dialogInput=new o("input",{className:`${u.dialogInput}`,id:"dialogInput"}),this.dialogFormButton=new o("button",{className:`${u.dialogFormButton}`,text:"Send",id:"dialogFormButton"}),this.handleSearchInputChange(),this.handleSelectUserToChatWith(),this.constructPage(),this.handleDialogueInputChange(),this.dialogForm.element.addEventListener("submit",this.onFormSubmit.bind(this))}handleSearchInputChange(){this.contactSearch.element.addEventListener("input",()=>{const e=this.contactSearch.element.value.trim();O.emit("searchInputChanged",e)})}handleDialogueInputChange(){this.dialogInput.element.addEventListener("input",()=>{this.dialogInput.element.value?this.dialogFormButton.element.removeAttribute("disabled"):this.dialogFormButton.element.setAttribute("disabled","")})}onFormSubmit(e){e.preventDefault();const s=this.dialogInput.element.value;this.dialogInput.element.value="",this.dialogFormButton.element.setAttribute("disabled",""),D.emit("eventMessageSent",s)}handleSelectUserToChatWith(){this.usersList.element.addEventListener("click",e=>{if(e.target instanceof HTMLElement){const s=e.target.closest("li");if(s){const a=s.getAttribute("id")||"";H.emit("userToChatWithSelected",a),this.displaySelectedUserInDialogue(a)}}})}displaySelectedUserInDialogue(e){var r,l;const s=(r=document.getElementById(`userLineName_${e}`))==null?void 0:r.innerText,a=(l=document.getElementById(`userLineStatus_${e}`))==null?void 0:l.getAttribute("data-status");s&&a&&this.setUserInfoToGialogHeader(s,a)}setUserInfoToGialogHeader(e,s){this.dialogHeaderUserName.element.textContent=e,this.dialogHeaderUserStatus.element.textContent=s==="true"?"Online":"Offline"}constructPage(){this.dialogFormButton.setAttribute("disabled","").setAttribute("type","submit"),this.dialogInput.setAttribute("placeholder","Enter your message...").setAttribute("disabled",""),this.contactSearch.setAttribute("placeholder","Search..."),this.aside.appendChildren([this.contactSearch,this.usersList]),this.dialogHeader.appendChildren([this.dialogHeaderUserName,this.dialogHeaderUserStatus]),this.dialogForm.appendChildren([this.dialogInput,this.dialogFormButton]),this.dialogBody.appendChild(this.dialogBodyText),this.dialogContainer.appendChildren([this.dialogHeader,this.dialogBody,this.dialogForm]),this.appendChildren([this.aside,this.dialogContainer]),this.renderDialogBodyText()}renderDialogBodyText(e="default",s=this.dialogBodyText.element){const a=s;let r;switch(e){case"userSelected":r="Enter your first message...";break;case"dialogStarted":r="";break;default:r="Select a user to send a message...";break}a.innerText=`${r}`}renderUsers(e,s){e.forEach(a=>{const r=a.login,l=a.isLogined||!1,g=new k(r,l);s.append(g.element)})}drawNewLoggedUser(e,s){const a=e.login,r=e.isLogined||!1,l=new k(a,r);s.prepend(l.element)}displayUpdatedStatus(e){const s=e.login,a=e.isLogined||!1,r=document.getElementById(`userLineStatus_${s}`);r&&r.setAttribute("data-status",`${a}`)}}class xe{constructor(t){i(this,"webSocketAPI");this.webSocketAPI=t}validateUserName(t){return/^(?=.*[a-z])(?=.*[A-Z])[a-zA-Z_-]*\d?[a-zA-Z_-]*$/.test(t)&&t.length>=4}validatePassword(t){return/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^\\da-zA-Z]).{8,}$/.test(t)&&t.length>=8}handleFormSubmit(t){this.webSocketAPI.userAuthentication(t)}}const $e="_login-page_1lwrq_1",Fe="_login-form-wrapper_1lwrq_4",Me="_login-form_1lwrq_4",Oe="_login-form-title_1lwrq_34",He="_login-form-input_1lwrq_43",De="_last-name-input_1lwrq_57",qe="_login-form-label_1lwrq_61",Re="_input-tooltip_1lwrq_75",We="_input-tooltip-active_1lwrq_103",Ve="_form-button_1lwrq_108",ze="_error-message_1lwrq_115",c={"login-page":"_login-page_1lwrq_1",loginPage:$e,"login-form-wrapper":"_login-form-wrapper_1lwrq_4",loginFormWrapper:Fe,"login-form":"_login-form_1lwrq_4",loginForm:Me,"login-form-title":"_login-form-title_1lwrq_34",loginFormTitle:Oe,"login-form-input":"_login-form-input_1lwrq_43",loginFormInput:He,"last-name-input":"_last-name-input_1lwrq_57",lastNameInput:De,"login-form-label":"_login-form-label_1lwrq_61",loginFormLabel:qe,"input-tooltip":"_input-tooltip_1lwrq_75",inputTooltip:Re,"input-tooltip-active":"_input-tooltip-active_1lwrq_103",inputTooltipActive:We,"form-button":"_form-button_1lwrq_108",formButton:Ve,"error-message":"_error-message_1lwrq_115",errorMessage:ze};class x extends o{constructor(e){super("section",{className:`${c.loginPage}`,id:"loginPage"});i(this,"controller");i(this,"form");i(this,"passwordInput");i(this,"loginInput");i(this,"loginButton");i(this,"infoButton");i(this,"loginLabel");i(this,"passwordLabel");i(this,"loginTooltip");i(this,"passwordTooltip");i(this,"formTitle");i(this,"errorMessage");i(this,"isLoginValid",!1);i(this,"isPasswordValid",!1);i(this,"webSocketAPI");this.webSocketAPI=e,this.controller=new xe(this.webSocketAPI),this.form=new o("form",{className:`${c.loginForm}`,id:"loginForm"}),this.formTitle=new o("h2",{className:`${c.loginFormTitle}`,text:"login",id:"loginForm"}),this.loginTooltip=new o("span",{text:"Use both upper and lower case English letters"}),this.passwordTooltip=new o("span",{text:"Requires upper and lower case letters and digits"}),this.loginInput=new o("input",{id:"loginInput",className:c.loginFormInput}),this.passwordInput=new o("input",{id:"passwordInput",className:c.loginFormInput}),this.loginLabel=new o("label",{text:"Login",className:c.loginFormLabel}),this.passwordLabel=new o("label",{text:"Password",className:c.loginFormLabel}),this.loginButton=new o("button",{className:c.formButton,text:"Log in",id:"loginBtn"}).setAttribute("type","submit").setAttribute("disabled","true"),this.infoButton=new o("button",{className:c.formButton,text:"About",id:"infoButton"}).setAttribute("type","button"),this.errorMessage=new o("p",{className:c.errorMessage}),this.setFormElements(),this.setEventListenerToForm(),this.setInputsProperties(),this.appendChild(this.form),h.subscribe("authError",s=>{this.drawErrorMessage(s)}),h.subscribe("aboutBtnClicked",this.disableBtn.bind(this)),h.subscribe("backButtonClicked",this.enableBtn.bind(this)),this.infoButton.element.addEventListener("click",this.onAboutBtnClick.bind(this))}setEventListenerToForm(){this.loginInput.element.addEventListener("input",this.inputLoginOnChange.bind(this)),this.passwordInput.element.addEventListener("input",this.inputPasswordOnChange.bind(this)),this.form.element.addEventListener("submit",e=>{e.preventDefault(),this.onFormSubmit()})}onAboutBtnClick(e){window.location.hash="#about",h.emit("aboutBtnClicked",e)}disableBtn(){this.infoButton.element.disabled=!0}enableBtn(){this.infoButton.element.disabled=!1}setInputsProperties(){this.passwordTooltip.element.classList.add(c.inputTooltip,c.inputTooltipPassword),this.loginTooltip.element.classList.add(c.inputTooltip,c.inputTooltipName),this.loginInput.setAttribute("type","text").setAttribute("required","true").setAttribute("name","loginForm").setAttribute("placeholder",'min length 4 chars, "-" and "_" allowed').setAttribute("minlength","4"),this.passwordInput.setAttribute("type","password").setAttribute("required","true").setAttribute("name","loginForm").setAttribute("placeholder","Password, min length 6 symbols").setAttribute("minlength","8")}setFormElements(){this.loginLabel.appendChild(this.loginTooltip),this.passwordLabel.appendChild(this.passwordTooltip),this.form.appendChildren([this.formTitle,this.loginLabel,this.loginInput,this.passwordLabel,this.passwordInput,this.loginButton,this.infoButton])}inputLoginOnChange(){const e=this.loginInput.element.value.trim();return this.isLoginValid=this.controller.validateUserName(e),this.loginButton.element.disabled=!this.loginBtnIsDisabled(),this.loginTooltip.element.style.opacity=this.isLoginValid?"0":"1",this.loginTooltip.element.style.visibility=this.isLoginValid?"hidden":"visible",this.isLoginValid}inputPasswordOnChange(){const e=this.passwordInput.element.value.trim();return this.isPasswordValid=this.controller.validatePassword(e),this.loginButton.element.disabled=!this.loginBtnIsDisabled(),this.passwordTooltip.element.style.opacity=this.isPasswordValid?"0":"1",this.passwordTooltip.element.style.visibility=this.isPasswordValid?"hidden":"visible",this.isPasswordValid}loginBtnIsDisabled(){return this.isPasswordValid&&this.isLoginValid}onFormSubmit(){const e={login:this.getLogin(),password:this.getPassword()};this.controller.handleFormSubmit(e)}getLogin(){return this.loginInput.element.value}getPassword(){return this.passwordInput.element.value}drawErrorMessage(e){this.errorMessage.element.textContent=`${e}`,this.form.appendChild(this.errorMessage),setTimeout(()=>{this.errorMessage.destroy(),this.passwordInput.element.value=""},2e3)}}function Ge(n){return"".includes(n)?"":"#chat".includes(n)?"#chat":"#about".includes(n)?"#about":""}class Je{constructor(t){i(this,"setPage");i(this,"currentPage");this.currentPage="",this.setPage=t,window.onhashchange=()=>{this.handleLocation()},window.onload=()=>{this.handleLocation()}}handleLocation(){const t=window.location.hash;this.currentPage=Ge(t),this.setPage(this.currentPage)}}const Ze="_main_mnmne_1",Ke={main:Ze},Xe="_message-container_rv15k_1",je="_message-content_rv15k_6",Ye="_message-header_rv15k_22",Qe="_message-header_user_rv15k_33",et="_message-header_date_rv15k_35",tt="_message-text_rv15k_38",st="_message-footer_rv15k_43",it="_message-footer_status_rv15k_54",m={"message-container":"_message-container_rv15k_1",messageContainer:Xe,"message-content":"_message-content_rv15k_6",messageContent:je,"message-header":"_message-header_rv15k_22",messageHeader:Ye,"message-header_user":"_message-header_user_rv15k_33",messageHeaderUser:Qe,"message-header_date":"_message-header_date_rv15k_35",messageHeaderDate:et,"message-text":"_message-text_rv15k_38",messageText:tt,"message-footer":"_message-footer_rv15k_43",messageFooter:st,"message-footer_status":"_message-footer_status_rv15k_54",messageFooterStatus:it};class at extends o{constructor(){super("div",{className:`${m.messageContainer}`});i(this,"messageContent");i(this,"messageHeader");i(this,"messageHeaderUser");i(this,"messageHeaderDate");i(this,"messageText");i(this,"messageFooter");i(this,"messageFooterStatus");this.messageContent=new o("div",{className:`${m.messageContent}`,id:"messageContent"}),this.messageHeader=new o("div",{className:`${m.messageHeader}`,id:"messageHeader"}),this.messageHeaderDate=new o("label",{className:`${m.messageHeaderDate}`,id:"messageHeaderDate"}),this.messageHeaderUser=new o("label",{className:`${m.messageHeaderUser}`,id:"messageHeaderUser"}),this.messageText=new o("div",{className:`${m.messageText}`,id:"messageText"}),this.messageFooter=new o("div",{className:`${m.messageFooter}`,id:"messageFooter"}),this.messageFooterStatus=new o("label",{className:`${m.messageFooterStatus}`,id:"messageFooterStatus"}),this.buildMessageElement()}buildMessageElement(){this.messageHeader.appendChildren([this.messageHeaderUser,this.messageHeaderDate]),this.messageFooter.appendChild(this.messageFooterStatus),this.messageContent.appendChildren([this.messageHeader,this.messageText,this.messageFooter]),this.appendChild(this.messageContent)}setMessageData(e){const{message:s,time:a,status:r,from:l,attributeValue:g}=e;this.messageText.element.innerText=s,this.messageHeaderDate.element.innerText=a,this.messageFooterStatus.element.innerText=r?"delivered":"",this.messageHeaderUser.element.innerText=l,this.messageContent.setAttribute("data-user",`${g}`)}}class ot{constructor(){i(this,"activeUsers",[]);i(this,"inactiveUsers",[]);i(this,"allUsers",[]);i(this,"currentUser",null);i(this,"recipient","");i(this,"mode","default")}updateActiveUsers(t){this.activeUsers=t.filter(e=>{var s;return e.login!==((s=this.currentUser)==null?void 0:s.login)})}updateInactiveUsers(t){this.inactiveUsers=t}setCurrentUser(t){this.currentUser=t}updateUserStatusArrays(t){const e=this.activeUsers.findIndex(a=>a.login===t.login),s=this.inactiveUsers.findIndex(a=>a.login===t.login);e!==-1?(this.activeUsers[e].isLogined=t.isLogined,this.inactiveUsers.push(...this.activeUsers.splice(e,1))):s!==-1?(this.inactiveUsers[s].isLogined=t.isLogined,this.activeUsers.push(...this.inactiveUsers.splice(s,1))):e===-1&&s===-1&&M.emit("newUserAuth",t)}searchUser(t,e){const s=document.getElementById("asideUsersList"),r=[...this.activeUsers,...this.inactiveUsers].filter(l=>l.login.toLowerCase().includes(t.toLowerCase()));s&&(s.innerHTML="",e(r,s))}}class nt{constructor(t,e){i(this,"chatModel");i(this,"webSocketAPI");i(this,"chatPage");this.webSocketAPI=t,this.chatPage=e,this.chatModel=new ot,f.subscribe("USER_ACTIVE_data",s=>{this.chatModel.updateActiveUsers(s.payload.users);const a=document.getElementById("asideUsersList");a&&this.chatPage.renderUsers(this.chatModel.activeUsers,a)}),f.subscribe("USER_INACTIVE_data",s=>{this.chatModel.updateInactiveUsers(s.payload.users);const a=document.getElementById("asideUsersList");a&&this.chatPage.renderUsers(this.chatModel.inactiveUsers,a)}),S.subscribe("USER_EXTERNAL_LOGIN",s=>{const{user:a}=s.payload;a&&(this.chatPage.displayUpdatedStatus(a),this.chatModel.updateUserStatusArrays(a))}),S.subscribe("USER_EXTERNAL_LOGOUT",s=>{const{user:a}=s.payload;a&&(this.chatPage.displayUpdatedStatus(a),this.chatModel.updateUserStatusArrays(a))}),M.subscribe("newUserAuth",this.callDrawNewUser.bind(this)),h.subscribe("successLogin",this.setCurUser.bind(this)),O.subscribe("searchInputChanged",this.callSearchHandler.bind(this)),H.subscribe("userToChatWithSelected",this.userToChatWithSelectedHandler.bind(this)),D.subscribe("eventMessageSent",this.messageSentHandler.bind(this)),q.subscribe("MSG_SEND",this.messageSentToServerHandler.bind(this))}messageSentHandler(t){const e=document.getElementById("dialogBodyText");this.chatModel.mode="dialogStarted",e&&this.chatPage.renderDialogBodyText(this.chatModel.mode,e);const s=t;this.webSocketAPI.sendMessage(s,this.chatModel.recipient)}messageSentToServerHandler(t){var U,A;const e=document.getElementById("dialogBody"),s=J(t.payload.message.datetime),a=t.payload.message.status.isDelivered||!1,r=t.payload.message.text;let{from:l}=t.payload.message;const g=((U=this.chatModel.currentUser)==null?void 0:U.login)===l?"current":"recipient";l=((A=this.chatModel.currentUser)==null?void 0:A.login)===l?"You":l;const C={time:s,status:a,message:r,from:l,attributeValue:g};console.log(C);const P=new at;P.setMessageData(C),e&&e.append(P.element)}userToChatWithSelectedHandler(t){this.chatModel.recipient=t,console.log("this.chatModel.recipient ",this.chatModel.recipient);const e=document.getElementById("dialogBodyText"),s=document.getElementById("dialogInput");this.chatModel.mode="userSelected",e&&this.chatPage.renderDialogBodyText(this.chatModel.mode,e),s&&s.removeAttribute("disabled")}callSearchHandler(t){this.chatModel.searchUser(t,this.chatPage.renderUsers)}callDrawNewUser(t){var e;if(t.login!==((e=this.chatModel.currentUser)==null?void 0:e.login)){const s=document.getElementById("asideUsersList");s&&this.chatPage.drawNewLoggedUser(t,s)}}setCurUser(){const t=F();t&&this.chatModel.setCurrentUser(t)}start(){this.setCurUser(),this.webSocketAPI.start()}}class rt extends o{constructor(e){super("main",{className:`${Ke.main}`,id:"main"});i(this,"router");i(this,"loginPage");i(this,"aboutPage");i(this,"chatPage");i(this,"webSocketAPI");i(this,"chatController");this.webSocketAPI=e,this.loginPage=new x(this.webSocketAPI),this.aboutPage=new E,this.chatPage=new T,this.chatController=new nt(this.webSocketAPI,this.chatPage),this.appendChild(this.loginPage),this.router=new Je(this.setPageContent.bind(this)),console.log(this.router),window.addEventListener("unload",()=>{this.setPageContent()}),this.chatController.start()}setPageContent(){const e=window.location.hash;if(v()||e==="#chat"&&(window.location.hash=""),v()){const s=document.getElementById("userInfo"),a=F();s&&(s.textContent=`${G()}`),a&&this.reLogUser(a)}e===""?this.drawLoginPage():e==="#chat"?this.drawChatPage():e==="#about"&&this.drawAboutPage()}reLogUser(e){const s={id:e.id||"",type:"USER_LOGIN",payload:{user:{login:e.login,password:e.password}}};this.webSocketAPI.ws.readyState===WebSocket.OPEN?this.webSocketAPI.ws.send(JSON.stringify(s)):this.webSocketAPI.ws.addEventListener("open",()=>{this.webSocketAPI.ws.send(JSON.stringify(s))})}drawAboutPage(){this.destroyChildren(),this.aboutPage=new E,this.appendChild(this.aboutPage)}drawChatPage(){this.destroyChildren(),this.chatPage=new T,this.appendChild(this.chatPage),this.webSocketAPI.ws.readyState===WebSocket.OPEN?(this.webSocketAPI.getAllAuthenticatedUsers(),this.webSocketAPI.getAllUnauthorizedUsers()):this.webSocketAPI.ws.addEventListener("open",()=>{this.webSocketAPI.getAllAuthenticatedUsers(),this.webSocketAPI.getAllUnauthorizedUsers()})}drawLoginPage(){this.destroyChildren(),this.loginPage=new x(this.webSocketAPI),this.appendChild(this.loginPage)}}class lt{constructor(){i(this,"ws");i(this,"errorMessage","");this.ws=new WebSocket("ws://127.0.0.1:4000")}userAuthentication(t){const e={id:L().toString(),type:"USER_LOGIN",payload:{user:t}};this.ws.readyState===WebSocket.OPEN?this.ws.send(JSON.stringify(e)):this.ws.addEventListener("open",()=>{this.ws.send(JSON.stringify(e))});const s={login:e.payload.user.login,password:e.payload.user.password,isLogined:!1,id:e.id};$(s)}userLogout(t,e){const s={id:B(),type:"USER_LOGOUT",payload:{user:{login:t,password:e}}};this.ws.send(JSON.stringify(s))}sendMessage(t,e){const s={id:B(),type:"MSG_SEND",payload:{message:{to:e,text:t}}};this.ws.send(JSON.stringify(s))}getAllAuthenticatedUsers(){const t={id:L().toString(),type:"USER_ACTIVE",payload:null};this.ws.send(JSON.stringify(t))}getAllUnauthorizedUsers(){const t={id:L().toString(),type:"USER_INACTIVE",payload:null};this.ws.send(JSON.stringify(t))}handleMessage(t){const e=JSON.parse(t.data);if(e.type==="ERROR"&&(this.errorMessage=e.payload.error,h.emit("authError",e.payload.error)),e.type==="USER_LOGIN"){h.emit("successLogin",e),window.location.hash="#chat";const{isLogined:s}=e.payload.user;z(s)}e.type==="USER_LOGOUT"&&(sessionStorage.clear(),window.location.hash="",h.emit("userLoggedOut",e)),e.type==="USER_ACTIVE"&&f.emit("USER_ACTIVE_data",e),e.type==="USER_INACTIVE"&&f.emit("USER_INACTIVE_data",e),e.type==="USER_EXTERNAL_LOGIN"&&S.emit("USER_EXTERNAL_LOGIN",e),e.type==="USER_EXTERNAL_LOGOUT"&&S.emit("USER_EXTERNAL_LOGOUT",e),e.type==="MSG_SEND"&&q.emit("MSG_SEND",e)}start(){this.ws.addEventListener("message",this.handleMessage.bind(this))}}class dt extends o{constructor(){super("div",{className:"site-wrapper",id:"siteWrapper"});i(this,"webSocketAPI");this.webSocketAPI=new lt;const e=new ce(this.webSocketAPI),s=new rt(this.webSocketAPI),a=new se;this.appendChildren([e,s,a])}}const ct=()=>new dt;class ut{constructor(t,e){i(this,"siteWrapper");i(this,"root");this.siteWrapper=t,this.root=e}start(){this.root.append(this.siteWrapper.element)}}const ht=new ut(ct(),document.body);ht.start();
